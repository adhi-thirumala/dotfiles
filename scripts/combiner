#!/usr/bin/env -S uv run
# /// script
# requires-python = ">=3.10"
# dependencies = [
#     "pypdf",
# ]
# ///

import sys
import argparse
from pathlib import Path
from pypdf import PdfWriter

def combine_pdfs(input_files: list[str], output_file: str = "combined.pdf", verbose: bool = False):
    """Combine multiple PDF files into a single PDF."""
    if not input_files:
        print("Error: No input PDF files provided", file=sys.stderr)
        sys.exit(1)

    writer = PdfWriter()
    valid_files = 0

    for pdf_file in input_files:
        pdf_path = Path(pdf_file)
        if not pdf_path.exists():
            print(f"Error: File not found: {pdf_file}", file=sys.stderr)
            sys.exit(1)

        if not pdf_path.suffix.lower() == '.pdf':
            print(f"Warning: Skipping non-PDF file: {pdf_file}", file=sys.stderr)
            continue

        if verbose:
            print(f"Adding: {pdf_file}")
        writer.append(str(pdf_path))
        valid_files += 1

    if len(writer.pages) == 0:
        print("Error: No valid PDF files to combine", file=sys.stderr)
        sys.exit(1)

    if verbose:
        print(f"\nWriting combined PDF to: {output_file}")
    writer.write(output_file)
    print(f"Successfully combined {valid_files} PDF(s) into {output_file}")
    if verbose:
        print(f"Total pages: {len(writer.pages)}")

if __name__ == "__main__":
    parser = argparse.ArgumentParser(
        description="Combine multiple PDF files into a single PDF.",
        epilog="Example: combiner file1.pdf file2.pdf file3.pdf -o merged.pdf"
    )

    parser.add_argument(
        "input_files",
        nargs="+",
        metavar="PDF",
        help="Input PDF files to combine (accepts any number of PDFs)"
    )

    parser.add_argument(
        "-o", "--output",
        default="combined.pdf",
        metavar="FILE",
        help="Output PDF filename (default: combined.pdf)"
    )

    parser.add_argument(
        "-v", "--verbose",
        action="store_true",
        help="Show detailed progress information"
    )

    args = parser.parse_args()

    combine_pdfs(args.input_files, args.output, args.verbose)
